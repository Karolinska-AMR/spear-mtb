$(document).ready(function(){function a(a){const c={};for(const d of a.samples){const a=d.seqid;d.summary=b(d),c[a]=d}return c}function b(a){let b={};for(const c of t)b[c]={rmu:!1,umu:!1,unmu_r:!1,unmu_u:!1,nomu:!0};if(a.variants&&Array.isArray(a.variants))for(const c of a.variants)c.catalog.startsWith("WHO__")&&c.grade&&(c.grade.startsWith("3")?(drug=c.drug.toLowerCase(),b.hasOwnProperty(drug)&&(b[drug].umu=!0,b[drug].nomu=!1)):(c.grade.startsWith("1")||c.grade.startsWith("2"))&&(drug=c.drug.toLowerCase(),b.hasOwnProperty(drug)&&(b[drug].rmu=!0,b[drug].nomu=!1)));if(a.unverified_mutations)for(const c of Object.values(a.unverified_mutations))c.catalog.startsWith("WHO__")&&c.grade&&(c.grade.startsWith("3")?(drug=c.drug.toLowerCase(),b.hasOwnProperty(drug)&&(b[drug].unmu_u=!0)):(c.grade.startsWith("1")||c.grade.startsWith("2"))&&(drug=c.drug.toLowerCase(),b.hasOwnProperty(drug)&&(b[drug].unmu_r=!0)));return b}function c(){let a,b=$("#pred-container");$.each(s,function(c,e){b.append(`<h5 class="m-2 text-center text-muted text-capitalize">${e.title}</h5>`),names=e.drugs;for(let f=0;f<names.length;f++)0==f%2&&(0<f&&b.append(a),a=document.createElement("div"),a.className="row"),a.append(d(names[f]));b.append(a)})}function d(a){a=a.toLowerCase();var b=document.createElement("div");b.className="col-sm-12 col-lg-6 mb-1";var c=document.createElement("div");c.className="metric-card bg-white rounded-md shadow-sm p-2 border border-gray-200",c.id=`${a}-card`;var d=document.createElement("div");d.className="d-flex flex-row justify-content-between",c.appendChild(d);var e=document.createElement("span");e.className="drug-text text-uppercase mt-1",e.textContent=a,d.appendChild(e);var f=document.createElement("div");f.className="icon-circle",d.appendChild(f);var g=document.createElement("div");g.className="pred-circle text-capitalize shadow-text text-bg-o",g.id=`${a}-predcircle`,g.textContent="?",f.appendChild(g);var h=document.createElement("div");return h.className="d-flex flex-column",h.id=`${a}-predmessages`,c.appendChild(h),b.appendChild(c),b}function e(){const a=Object.keys(q).sort((c,a)=>c.localeCompare(a)),b=$("#species-groups");b.empty();let c={DS:"text-green-500",Poly:"text-yellow-400",MDR:"text-red-500",XDR:"text-purple-500",Mono:"text-cyan-500","Pre-XDR":"text-purple-400","Pre-MDR":"text-red-400"},d=0;const e=$("<div>").addClass("space-y-1");for(const f of a)if(q.hasOwnProperty(f)){let a=q[f].category_who,g=c[a]||"text-gray-400";const h=$("<div>").addClass("sidebar-item px-4 py-2 text-sm font-medium text-gray-800 cursor-pointer flex items-center").append($("<i>").addClass("fas fa-circle mr-2 "+g)).append(f);e.append(h),b.append(e),d++}f()}function f(){document.querySelectorAll(".sidebar-item").forEach(a=>{a.addEventListener("click",()=>{document.querySelectorAll(".sidebar-item").forEach(a=>{a.classList.remove("active")}),a.classList.add("active");const b=a.textContent.trim();let c="blue";try{const b=a.querySelector("i").classList[3];b&&(c=b.split("-")[1]||"blue")}catch(a){console.error("Error fetching icon color:",a)}$("#main-container").removeClass("hidden"),r!==b&&(r=b,o(),setTimeout(()=>{n(b,c)},100));const d=document.querySelector(".flex-1");d.classList.add("opacity-50"),setTimeout(()=>{d.classList.remove("opacity-50")},500)})})}function g(a){if(a.hasOwnProperty("fraction")){$("#lin-fraction").text(a.fraction);const b=parseFloat(a.fraction);let c="fas fa-exclamation-circle text-red-500",d="species-badge bg-red-100 text-red-800";.8<b?(c="fas fa-check-circle text-green-500",d="species-badge bg-green-100 text-green-800"):.5<=b&&(c="fas fa-exclamation-triangle text-yellow-500",d="species-badge bg-yellow-100 text-yellow-800"),$("#lin-fraction-icon").remove(),$("#lin-fraction").append($("<i>").addClass(c).attr("id","lin-fraction-icon").addClass("ml-2")),$("#lin-lineage").html(`<span class="${d}">${a.lineage}</span>`)}if(a.hasOwnProperty("family")&&$("#lin-family").text(a.family),a.hasOwnProperty("rd")){const b=a.rd;$("#lin-rd").text(""===b?"-":b)}if(a.hasOwnProperty("spoligotype")){const b=a.spoligotype;$("#lin-spoligotype").text(""===b?"-":b.toLocaleString())}}function h(a){$.each(a,function(a,b){let c=$(`#${a}-predcircle`),d=$(`#${a}-predmessages`);d.empty(),b.rmu&&!b.unmu_r?(c.addClass("text-bg-r"),c.text("R"),d.append(`<p class="text-secondary text-message"><i class="fa-solid fa-circle-info fa-lg"></i> At least one resistance mutation was identified.</p>`)):!b.rmu&&b.unmu_r?(c.addClass("text-bg-k"),c.text("!"),d.append(`<p class="text-danger text-message"><i class="fa-solid fa-lg fa-circle-exclamation"></i> Some resistance mutations from WHO catalogue cannot be verified.</p>`)):b.rmu||b.unmu_r||!b.umu?b.nomu&&(c.addClass("text-bg-s"),c.text("S"),d.append(`<p class="text-secondary text-message"><i class="fa-solid fa-circle-info fa-lg"></i> No resistance or uncertain mutations were found.</p>`)):(c.addClass("text-bg-s"),c.text("S"),d.append(`<p class="text-warning text-message"><i class="fa-solid fa-triangle-exclamation fa-lg"></i> Mutations of uncertain significance were found.</p>`)),b.unmu_r&&d.append(`<p class="text-warning text-message"><i class="fa-solid fa-triangle-exclamation fa-lg"></i> some mutations with uncertain significance cannot be verified.</p>`)})}function i(a){function b(a,b){return $.grep(a,function(a){return a.catalog&&a.catalog.startsWith(b)})}let c=$("#who-table"),d=$("#cryptic-table"),e=$("#tbprof-table");c.bootstrapTable("load",JSON.parse(JSON.stringify(b(a,"WHO__")))),d.bootstrapTable("load",JSON.parse(JSON.stringify(b(a,"CRyPTIC__")))),e.bootstrapTable("load",JSON.parse(JSON.stringify(b(a,"TB-Profiler__"))))}function j(a){let b=$("#unmu-table");b.bootstrapTable("load",JSON.parse(JSON.stringify(a)))}function k(a){return a.replace(/#/g,"No. ").replace(/\(.*?\)/g,a=>a.toLowerCase())}function l(a){let b=`<div class="mb-4"><div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2">`;for(const[c,d]of Object.entries(a))b+=`<div class="metric-card bg-white rounded-md shadow-sm p-2 border border-gray-200"><h3 class="text-sm font-medium text-gray-600 truncate">${k(c)}</h3><p class="text-base text-blue-500">${d.toLocaleString()}</p></div>`;return b+=`</div></div>`,b}function m(a){$("#qc-container").empty(),$("#qc-container").append(l(a))}function n(a,b){let c=q[a];if($("#header-id").html(`Selected Isolate: <span class="text-${b}-600">${c.seqid}</span>`),c.lineage&&c.lineage.hasOwnProperty("lineage")&&g(c.lineage),c.hasOwnProperty("summary")&&h(c.summary),c.variants&&i(c.variants),c.unverified_mutations){let a=$.grep(Object.values(c.unverified_mutations),function(a){return a.catalog&&a.catalog.startsWith("WHO__")});j(a)}let d="-";if(c.hasOwnProperty("analyzed_catalogs"))if(Array.isArray(c.analyzed_catalogs)){const a=[...new Set(c.analyzed_catalogs)];d=a.map(a=>"string"==typeof a?a.replace(/__/g,": "):a).join("<br>")}else d="string"==typeof c.analyzed_catalogs?c.analyzed_catalogs.replace(/__/g,": "):c.analyzed_catalogs;const e={"Genome Median Depth":c.hasOwnProperty("genome_median_depth")?c.genome_median_depth:"-","No. Mapped Reads":c.hasOwnProperty("num_mapped_reads")?c.num_mapped_reads:"-","Reads Mapped (%)":c.hasOwnProperty("percent_reads_mapped")?c.percent_reads_mapped:"-","Processed Catalogues":d};m(e);const f=document.querySelectorAll("[data-bs-spy=\"scroll\"]");f.forEach(a=>{bootstrap.ScrollSpy.getInstance(a).refresh()})}function o(){$("table").each(function(){$(this).hasClass("bts-table")?$(this).bootstrapTable("removeAll"):$(this).find("td").each(function(){$(this).text("\u23F3")})}),$(".metric-card").each(function(){$(this).find("p").text("\u23F3")}),$(".kl-gi-data-holder").each(function(){$(this).text("\u23F3")}),$(".kl-am-data-holder").each(function(){$(this).text("\u23F3")}),$(".pred-circle").each(function(){$(this).removeClass("text-bg-o").removeClass("text-bg-s").removeClass("text-bg-r").removeClass("text-bg-k"),$(this).text("\u23F3")})}function p(){document.querySelectorAll(".tab-button").forEach(a=>{a.addEventListener("click",()=>{const b=a.closest(".tab-container");b.querySelectorAll(".tab-button").forEach(a=>{a.classList.remove("active")}),b.querySelectorAll(".tab-content").forEach(a=>{a.classList.remove("active")}),a.classList.add("active");const c=a.getAttribute("data-tab"),d=document.getElementById(`${c}-tab`);d&&d.classList.add("active")})})}let q,r="";var s={first_line:{title:"First-line antitubercular drugs",drugs:["rifampicin","isoniazid","pyrazinamide","ethambutol"]},second_line:{title:"second-line antitubercular drugs",drugs:["levofloxacin","moxifloxacin","linezolid","bedaquiline"]},other:{title:"Other drugs",drugs:["clofazimine","delamanid","ethionamide","amikacin","capreomycin","kanamycin","streptomycin"]}};let t=Object.values(s).flatMap(a=>a.drugs);(function(){q=a(data_rw),e(),p(),c();const b=document.querySelector(".sidebar-item");b&&b.click()})()});